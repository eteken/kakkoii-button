$(function(){"use strict";function v(e,t){setTimeout(function(){$(".screen:not([hidden])").attr("hidden","hidden").fadeOut(function(){$(e).removeAttr("hidden").fadeIn(t)})},1e3)}function m(){v("#zapper-main");e.connect(function(o){if(o)return alert("サーバとの接続に失敗しました。アプリケーションはご利用頂けません。");n=e.user;$("#user-icon img").attr("src",n.photos[0]);$("#zapper-main h1:first").text(t.title);t.onZapSent=function(e){var t=e.count;(function n(){var e=-(d*t);p.css("backgroundPosition",e+"px 0");t--;t>=0&&setTimeout(n,40)})();$("#zap-button").removeAttr("disabled")};t.subscribe("message",function(e){r.push(e);if(i){var t=common.renderMessage(e);f.find(":first").before(t)}else{s++;g()}});r=__lt_messages__.reverse();s=r.length;g()})}function g(){if(!s){u.text("").hide();a.removeClass("active")}else{u.text(s).show();a.addClass("active")}}function y(){if(!e.loggedIn)return alert("ログインしていません");var n=t.zap(),r=n.count;r===t.maxZapCount&&$(this).attr("disabled","disabled");var i=-d*r;p.css("backgroundPosition",i+"px 0")}function b(){var e=[];for(var t=r.length-1;t>=0;t--){var n=r[t];e.push(common.renderMessage(n))}f.html(e.join("")).show();s=0}function w(){f.empty().hide()}function S(e){clearTimeout(E);var t=Date.now();(function n(){var r=Date.now(),i=r-t;if(i>e*1e3)T();else{var s=Math.floor(i/1e3);h.text(e-s);E=setTimeout(n,200)}})()}function x(e,t){l.addClass("active");t=t||{};l.data("options",t);c.val("");h.text("");l.show();t.relatedZapUUID||setTimeout(function(){c.focus()},0);if(t.autoCloseSeconds>0){var n=t.autoCloseSeconds;S(n)}}function T(){l.removeData("options").removeClass("active")}typeof window.setImmediate!="function"&&(window.setImmediate=async.setImmediate=async.nextTick=function(e){setTimeout(e,0)});var e=new Zapper,t=e.event(__lt_event__),n,r,i,s=0,o=$("#zap-button"),u=$("#msg-notifier .msg-count"),a=$("#msg-notifier .icon"),f=$("#messages"),l=$("#message-dialog"),c=l.find(".message-input"),h=l.find(".count"),p=$("#buttons-container"),d=p.outerWidth();(function(){e.loggedIn?m():v("#login-screen")})();(function(){setTimeout(function(){window.scrollTo(0,1)},100)})();$("#login-command").fastClick(function(){e.login({mobileAuth:!0,eventId:t._id},function(e,t){if(e)return;m()})});(function(){var t=["btnBg_00.png","btnBg_01.png","btnBg_02.png","btnBg_03.png","btnBg_04.png","btnBg_05.png","zapBtn_off.png","zapBtn_on.png","msg_on.png","msg_off.png","msgBtn_off.png","msgBtn_on.png"],n="/img/";_.each(t,function(e){var t=new Image;t.src=n+e;t.onload=function(){console.log("preload image:"+e)}})})();o.fastClick(y);$("#msg-notifier").fastClick(function(){i?w():b();g();i=!i});$("#message-dialog .send-message-button").fastClick(function(){if(!e.loggedIn)return alert("ログインしていません");var n=$("#message-dialog"),r=n.find(".message-input"),i=r.val();if(i.length===0)return;var s=n.data("options")||{};t.sendMessage(i,s.relatedZapUUID);r.val("");T()});$("#message-dialog .cancel-button").fastClick(function(){T()});var E;c.on("focus",function(){clearTimeout(E);h.text("")});$("#msg-button").fastClick(function(){x(this)});$("#logout-button").fastClick(function(){confirm("ログアウトしますか?")&&$.get("/logout",function(){location.reload()})})});