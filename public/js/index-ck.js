$(function(){"use strict";function a(e,t){setTimeout(function(){$(".screen:not([hidden])").attr("hidden","hidden").fadeOut(function(){$(e).removeAttr("hidden").fadeIn(t)})},1e3)}function f(){a("#zapper-main");t.connect(function(r){if(r)return alert("サーバとの接続に失敗しました。アプリケーションはご利用頂けません。");n=t.user;e=t.event(__lt_event__);$("#user-icon img").attr("src",n.photos[0]);$("#zapper-main h1:first").text(e.title);e.onZapSent=function(e){var t='url("/img/btnBg_00.png")';u.css("backgroundImage",t);$("#zap-button").text("(いいね!)").removeAttr("disabled");h("#zap-button",{relatedZapUUID:e.uuid,autoCloseSeconds:3})}})}function c(e){var t=Date.now();(function n(){var r=Date.now(),i=r-t;if(i>e*1e3)p();else{var s=Math.floor(i/1e3);o.text(e-s);l=setTimeout(n,200);console.log(l)}})()}function h(e,t){i.addClass("active");t=t||{};i.data("options",t);s.val("");o.text("");i.show();t.relatedZapUUID||setTimeout(function(){s.focus()},0);if(t.autoCloseSeconds>0){var n=t.autoCloseSeconds;c(n)}}function p(){i.removeData("options").removeClass("active")}typeof window.setImmediate!="function"&&(window.setImmediate=async.setImmediate=async.nextTick=function(e){setTimeout(e,0)});var e,t=new Zapper,n,r,i=$("#message-dialog"),s=i.find(".message-input"),o=i.find(".count"),u=$("#buttons-container");(function(){t.loggedIn?f():a("#login-screen")})();$("#login-command").fastClick(function(){t.login(null,function(e,t){if(e)return;f()})});(function(){var t=["btnBg_00.png","btnBg_01.png","btnBg_02.png","btnBg_03.png","btnBg_04.png","btnBg_05.png","zapBtn_off.png","zapBtn_on.png","msg_on.png","msg_off.png","msgBtn_off.png","msgBtn_on.png"],n="/img/";_.each(t,function(e){var t=new Image;t.src=n+e;t.onload=function(){console.log("preload image:"+e)}})})();$("#zap-button").fastClick(function(){if(!t.loggedIn)return alert("ログインしていません");var n=e.zap(),r=n.count;r===e.maxZapCount&&$(this).attr("disabled","disabled");var i='url("/img/btnBg_'+_.str.lpad(String(r),2,"0")+'.png")';u.css("backgroundImage",i)});$("#message-dialog .send-message-button").click(function(){if(!t.loggedIn)return alert("ログインしていません");var n=$("#message-dialog"),r=n.find(".message-input"),i=r.val();if(i.length===0)return;var s=n.data("options")||{};e.sendMessage(i,s.relatedZapUUID);r.val("");p()});$("#message-dialog .cancel-button").click(function(){p()});var l;s.on("focus",function(){console.log(l);clearTimeout(l);o.text("")});$("#msg-button").click(function(){h(this)})});