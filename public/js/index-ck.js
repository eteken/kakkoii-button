$(function(){"use strict";function l(e,t){setTimeout(function(){$(".screen:not([hidden])").attr("hidden","hidden").fadeOut(function(){$(e).removeAttr("hidden").fadeIn(t)})},1e3)}function c(){l("#zapper-main");t.connect(function(s){if(s)return alert("サーバとの接続に失敗しました。アプリケーションはご利用頂けません。");n=t.user;e=t.event(__lt_event__);$("#user-icon img").attr("src",n.photos[0]);$("#zapper-main h1:first").text(e.title);e.onZapSent=function(e){var t='url("/img/btnBg_00.png")';f.css("backgroundImage",t);$("#zap-button").text("(いいね!)").removeAttr("disabled");v("#zap-button",{relatedZapUUID:e.uuid,autoCloseSeconds:3})};e.subscribe("message",function(e){r.push(e);i++;h()});r=__lt_messages__;i=r.length;h();delete window.__lt_messages__})}function h(){i?s.text(i).show():s.text("").hide()}function d(e){var t=Date.now();(function n(){var r=Date.now(),i=r-t;if(i>e*1e3)m();else{var s=Math.floor(i/1e3);a.text(e-s);p=setTimeout(n,200);console.log(p)}})()}function v(e,t){o.addClass("active");t=t||{};o.data("options",t);u.val("");a.text("");o.show();t.relatedZapUUID||setTimeout(function(){u.focus()},0);if(t.autoCloseSeconds>0){var n=t.autoCloseSeconds;d(n)}}function m(){o.removeData("options").removeClass("active")}typeof window.setImmediate!="function"&&(window.setImmediate=async.setImmediate=async.nextTick=function(e){setTimeout(e,0)});var e,t=new Zapper,n,r,i=0,s=$("#msg-notifier .msg-count"),o=$("#message-dialog"),u=o.find(".message-input"),a=o.find(".count"),f=$("#buttons-container");(function(){t.loggedIn?c():l("#login-screen")})();$("#login-command").fastClick(function(){t.login(null,function(e,t){if(e)return;c()})});(function(){var t=["btnBg_00.png","btnBg_01.png","btnBg_02.png","btnBg_03.png","btnBg_04.png","btnBg_05.png","zapBtn_off.png","zapBtn_on.png","msg_on.png","msg_off.png","msgBtn_off.png","msgBtn_on.png"],n="/img/";_.each(t,function(e){var t=new Image;t.src=n+e;t.onload=function(){console.log("preload image:"+e)}})})();$("#zap-button").fastClick(function(){if(!t.loggedIn)return alert("ログインしていません");var n=e.zap(),r=n.count;r===e.maxZapCount&&$(this).attr("disabled","disabled");var i='url("/img/btnBg_'+_.str.lpad(String(r),2,"0")+'.png")';f.css("backgroundImage",i)});$("#message-dialog .send-message-button").fastClick(function(){if(!t.loggedIn)return alert("ログインしていません");var n=$("#message-dialog"),r=n.find(".message-input"),i=r.val();if(i.length===0)return;var s=n.data("options")||{};e.sendMessage(i,s.relatedZapUUID);r.val("");m()});$("#message-dialog .cancel-button").fastClick(function(){m()});var p;u.on("focus",function(){console.log(p);clearTimeout(p);a.text("")});$("#msg-button").fastClick(function(){v(this)});$("#logout-button").fastClick(function(){$.get("/logout",function(){location.reload()})})});